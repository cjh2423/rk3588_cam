# 虚拟机交叉编译环境搭建指南

本指南用于在 x86_64 Ubuntu 虚拟机上搭建 RK3588 (aarch64) 的交叉编译环境。

## 1. 配置 APT 源 (Multi-arch)

为了安装 arm64 架构的库 (如 Qt5, OpenCV)，需要配置 Ubuntu 的多架构源。

### 1.1 备份源列表
```bash
sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
```

### 1.2 修改源列表
```bash
sudo nano /etc/apt/sources.list
```
在文件末尾添加 arm64 端口源 (以 Ubuntu 22.04 jammy 为例):

```text
# arm64 架构专用源
deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ jammy main restricted universe multiverse
deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ jammy-updates main restricted universe multiverse
deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports/ jammy-security main restricted universe multiverse
```
*(注意：建议使用官方 ports 源或清华源的 ubuntu-ports 镜像)*

### 1.3 启用多架构并更新
```bash
sudo dpkg --add-architecture arm64
sudo apt update
```

## 2. 安装交叉编译器与模拟器

```bash
# 安装 qemu 模拟器 (用于可能的运行测试，虽不完美但有用)
sudo apt install qemu-user-static binfmt-support
sudo update-binfmts --enable qemu-aarch64

# 安装交叉编译器
sudo apt install g++-aarch64-linux-gnu gcc-aarch64-linux-gnu
```

## 3. 安装开发依赖库 (ARM64)

直接安装目标架构的开发包，这样 CMake 可以直接找到头文件和库。

```bash
# 基础构建工具
sudo apt install cmake make

# Qt5 (核心、GUI、Widgets)
sudo apt install qtbase5-dev:arm64 qtchooser qt5-qmake:arm64

# OpenCV (开发包)
sudo apt install libopencv-dev:arm64

# SQLite3
sudo apt install libsqlite3-dev:arm64

# Zlib
sudo apt install zlib1g-dev:arm64
```

## 4. 验证环境

### 4.1 检查编译器
```bash
aarch64-linux-gnu-g++ --version
```

### 4.2 检查库路径
确保库文件存在于 `/usr/lib/aarch64-linux-gnu/`：
```bash
ls /usr/lib/aarch64-linux-gnu/cmake/Qt5
ls /usr/lib/aarch64-linux-gnu/libopencv_core.so
```

## 5. 编译项目

使用项目根目录下的 `build.sh` 脚本：
```bash
./build.sh
```
该脚本会自动设置 `CMAKE_C_COMPILER` 和 `CMAKE_CXX_COMPILER` 为上述交叉编译器。
