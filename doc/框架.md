# RK3588 异步 AI 视频处理框架架构

本项目采用 **生产者-消费者** 模型，通过多个独立线程实现性能最大化。

## 1. 线程分工

### 1.1 主线程 (Qt UI Thread)
- **渲染**：接收已完成推理和画框的图像并显示。
- **调度**：通过 `AppController` 中的 `QTimer` (10ms) 驱动数据在线程间流转。

### 1.2 预处理线程 (Preprocessing Thread)
- **采集**：从 `CameraDevice` 获取 V4L2 原始帧。
- **RGA 加速**：使用硬件执行水平翻转 (`imflip_t`) 和 缩放 (`imresize_t`)。
- **输出**：生成 `PreprocessTask` 进入任务队列。

### 1.3 推理线程 (InferenceThread)
- **NPU 推理**：调用 `ModelManager` 管理的 RKNN 上下文执行 YOLOv8-face。
- **输出**：将原始 Tensor 数据推送到 `PostProcessThread`。

### 1.4 后处理线程 (PostProcessThread) [新增]
- **CPU 计算**：执行 NMS (非极大值抑制) 和坐标还原。
- **人脸识别**：裁剪人脸并调用 FaceNet 提取特征。
- **业务逻辑**：特征搜索、数据库比对、考勤记录。

## 2. 数据流向 (Data Flow)
1.  `PreprocessingThread` 抓图并 RGA 处理 -> **Preprocess Queue**.
2.  `InferenceThread` 消费图像 -> 执行 YOLO 推理 -> **PostProcess Queue**.
3.  `PostProcessThread` 消费 Tensor -> NMS & FaceNet -> **Result Buffer**.
4.  `AppController` 提取最终结果 -> **Qt updateFrame**.

## 3. 性能优化点
- **零拷贝渲染**：`QImage` 直接指向 `cv::Mat` 内存，避免像素拷贝。
- **C 接口调用**：针对 RGA 使用 `_t` 后缀的 C API，解决链接符号兼容性问题。
- **异步解耦**：推理耗时不阻塞采集，UI 刷新不受算法波动影响。