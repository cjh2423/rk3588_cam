# RK3588 异步 AI 视频处理框架架构

本项目采用 **生产者-消费者** 模型，通过多个独立线程实现性能最大化。

## 1. 线程分工

### 1.1 主线程 (Qt UI Thread)
- **渲染**：接收已完成推理和画框的图像并显示。
- **调度**：通过 `AppController` 中的 `QTimer` (10ms) 驱动数据在线程间流转。

### 1.2 预处理线程 (Preprocessing Thread)
- **采集**：从 `CameraDevice` 获取 V4L2 原始帧。
- **RGA 加速**：使用硬件执行水平翻转 (`imflip_t`) 和 缩放 (`imresize_t`)。
- **输出**：生成 `PreprocessTask` 进入任务队列。

### 1.3 推理线程 (InferenceThread)
- **NPU 推理**：调用 `ModelManager` 管理的 RKNN 上下文执行 YOLOv8-face。
- **业务逻辑**：在 `app/` 层实现结果解析、画框、关键点绘制。
- **输出**：更新 `latest_result` 供 UI 提取。

## 2. 数据流向 (Data Flow)
1.  `PreprocessingThread` 抓图并 RGA 处理 -> **Task Queue**.
2.  `AppController::onFrameTick` 发现新任务 -> **Push to InferenceThread**.
3.  `InferenceThread` 执行 NPU 计算并在图中画框 -> **Result Buffer**.
4.  `AppController::onFrameTick` 提取结果 -> **Qt updateFrame**.

## 3. 性能优化点
- **零拷贝渲染**：`QImage` 直接指向 `cv::Mat` 内存，避免像素拷贝。
- **C 接口调用**：针对 RGA 使用 `_t` 后缀的 C API，解决链接符号兼容性问题。
- **异步解耦**：推理耗时不阻塞采集，UI 刷新不受算法波动影响。