# RK3588 部署手册 (ADB)

## 1. 虚拟机编译 (Ubuntu)
```bash
cd ~/My_Project/rk3588/cam_demo

# 1. 编译主程序 (自动拷贝 cam_demo 到根目录)
./build.sh

# 2. 编译数据库工具
cd tools/db_tool
./build.sh
cd ../..
```

## 2. Windows 传输 (PowerShell)
确保开发板已开启 ADB 并在同一网络。

```powershell
# 1. 连接
adb connect 192.168.1.103

# 2. 创建目录
adb shell "mkdir -p /home/firefly/cjh/cam_demo"

# 3. 推送程序、模型与依赖
adb push cam_demo /home/firefly/cjh/cam_demo/
adb push tools/db_tool/build/db_tool /home/firefly/cjh/cam_demo/
adb push run.sh /home/firefly/cjh/cam_demo/
adb push 3rdparty /home/firefly/cjh/cam_demo/
adb push model /home/firefly/cjh/cam_demo/
```

## 3. 运行程序
```powershell
# 1. 设置权限 (文件由adb上传后通常属主为root，需sudo修改权限)
adb shell "cd /home/firefly/cjh/cam_demo/ && echo firefly | sudo -S chmod +x db_tool run.sh cam_demo"

# 2. 初始化数据库 (首次运行需执行)
adb shell "cd /home/firefly/cjh/cam_demo/ && ./db_tool init ./data.db"

# 3. 运行主程序
adb shell "cd /home/firefly/cjh/cam_demo/ && ./run.sh"
```

## 4. 关键路径说明 (config.h)
程序将直接访问以下路径：
- **检测模型**: `/home/firefly/cjh/cam_demo/model/yolov8n-face-zjykzj.rknn`
- **识别模型**: `/home/firefly/cjh/cam_demo/model/w600k_resnet50.rknn`
- **数据库**: `./data.db` (程序运行目录下的 data.db)

## 5. 功能说明
- **实时预览**: 启动后显示摄像头画面。
- **人脸识别**: 
    - **绿框**: 已注册用户，显示姓名。
    - **红框**: 未注册用户。
- **UI交互**:
    - 点击 **"Register Face"** 按钮：进入注册界面，输入姓名和部门，录入当前人脸。
    - 点击 **"User Manager"** 按钮：查看已注册用户列表，可删除用户。

## 6. 调试建议
- **日志过滤**: `run.sh` 默认过滤了 `rk-debug` 日志，如需查看底层 RGA 输出，请修改 `run.sh` 移除 `grep` 过滤。
- **权限**: 若打不开摄像头，请执行 `sudo chmod 777 /dev/video*`。
