# 数据库集成说明

本项目集成了 SQLite 数据库，用于存储人员信息、人脸特征和考勤记录。

## 1. 数据库文件
*   **文件名**: `data.db`
*   **位置**: 程序运行根目录下。
*   **生成方式**: 首次运行 `db_tool init` 或程序自动检测创建（如果实现了自动初始化）。目前推荐使用 `db_tool` 初始化。

## 2. 表结构设计

### 2.1 users (用户表)
存储用户的基本身份信息。

| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| user_id | INTEGER | 主键，自增 |
| user_name | TEXT | 姓名 (唯一) |
| employee_id | TEXT | 工号 |
| department | TEXT | 部门 |
| status | INTEGER | 1=启用, 0=禁用 |

### 2.2 face_features (特征表)
存储人脸特征向量 (512维)。

| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| feature_id | INTEGER | 主键 |
| user_id | INTEGER | 关联 users 表 |
| feature_vector | BLOB | 2048字节 (512 * float) |
| feature_quality | REAL | 质量分 |

### 2.3 attendance_records (考勤表)
记录识别结果。

| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| record_id | INTEGER | 主键 |
| user_id | INTEGER | 用户ID |
| check_time | INTEGER | 打卡时间戳 |
| check_type | INTEGER | 1=签到, 2=签退 |
| status | INTEGER | 1=正常, 2=迟到, 3=早退 |
| similarity | REAL | 识别相似度 |

## 3. 部署与使用
由于是交叉编译环境，数据库文件通常在 PC 端生成测试数据后拷贝到板端，或者直接在板端初始化。

### 3.1 常用操作流程
1.  **初始化**: 在板端运行 `./db_tool init ./data.db`。
2.  **注册用户**: `./db_tool add_user ./data.db "张三" "研发部"`。
3.  **运行程序**: `./cam_demo` (程序启动时会自动加载 `./data.db`)。

### 3.2 常见问题
*   **Permission denied**: 确保程序对当前目录有写权限。
*   **Database locked**: SQLite 是文件锁，避免多进程同时写入。目前设计为单进程独占 (`cam_demo` 运行时不要操作 `db_tool` 写数据)。
